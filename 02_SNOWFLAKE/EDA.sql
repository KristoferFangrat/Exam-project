USE ROLE EXAMDBTROLE;

USE DATABASE EXAM_DB;

USE WAREHOUSE EXAM_WH;

USE SCHEMA STAGING1;


SELECT Name, URL, COUNT(*) AS duplicate_count
FROM EVENT_RESOURCE
GROUP BY Name, URL
HAVING COUNT(*) > 1;

WITH CTE AS (
    SELECT 
        *,
        ROW_NUMBER() OVER (PARTITION BY Name, URL ORDER BY ID) AS row_num
    FROM EVENT_RESOURCE
)
SELECT * FROM CTE WHERE row_num > 1; -- View duplicates to be deleted


DELETE FROM EVENT_RESOURCE
WHERE ID IN (
    SELECT ID
    FROM (
        SELECT 
            ID,
            ROW_NUMBER() OVER (PARTITION BY Name, URL ORDER BY ID) AS row_num
        FROM EVENT_RESOURCE
    ) subquery
    WHERE row_num > 1
);

USE DATABASE EXAM_DB; 

DROP TABLE WEATHER_RESOURCE;

CREATE TABLE IF NOT EXISTS EXAM_DB.STAGING1.WEATHER_RESOURCE (
    id INT,
    lat FLOAT,
    lon FLOAT,
    time TIMESTAMP,
    temperature FLOAT,
    precipitation FLOAT
);